window.requestFileSystem||(window.requestFileSystem=window.webkitRequestFileSystem);
Registry.require("promise layout xmlhttprequest crcrc curtain cache layout/default/tabview layout/default/htmlutil helper statistics i18n syncinfo uri layout/default/layout_helper porter".split(" "),function(){var ca=rea.FEATURES,M=Registry.get("promise"),r=Registry.get("crcrc").cr,k=Registry.get("crcrc").crc,ia=Registry.get("layout/default/tabview"),n=Registry.get("layout/default/htmlutil"),Ha=Registry.get("statistics"),ja=Registry.get("syncinfo"),ka=Registry.get("cache"),u=Registry.get("curtain"),
e=Registry.get("i18n"),t=Registry.get("helper"),la=Registry.get("uri"),N=Registry.get("porter"),ma=Registry.get("layout"),na=Registry.get("layout/default/layout_helper"),O=na.images;ma.render(function(){na.addStyle();na.addFont();var Y={},w={},z=[],oa="0.0.0",S={},Aa={},P={},T=!0,q={},H=function(a,b){if(q[a]&&q[a][b])return q[a][b].apply(this,Array.prototype.slice.call(arguments,2));console.log("option: WARN: unable to find callback '"+b+"' for id '"+a+"'")},Q,Ba=function(){Q=t.getUrlArgs(!0)};window.onhashchange=
Ba;Ba();Q.open&&(Q.selected="dashboard");(function(){z.push(function(){w.statistics_enabled&&Ha.init("opt",oa)})})();var pa=t.getDebouncer(1E3),qa=function(){for(;z.length;)try{z.shift()()}catch(a){console.warn("doneListeners:",a)}},ma=function(a,b){var c=r("input",a.name,a.id,"Save");c.inserted||(c.type="button",c.section=a,c.value=e.getMessage("Save"),c.addEventListener("click",function(){if(!b||!b.warning||Z(b.warning)){var a=Array.prototype.slice.call(this.section.getElementsByTagName("textarea")),
c=function(b){b.each(function(b,c){a.push(c)})};c($("#"+this.section.id).find("input"));c($("#"+this.section.id).find("select"));for(c=0;c<a.length;c++){var f=null,h=a[c],m=h.key;if("textarea"==h.tagName.toLowerCase())if(h.array)for(var h=h.value.split("\n"),f=[],l=0;l<h.length;l++)h[l]&&""!=h[l].trim()&&f.push(h[l]);else f=h.value;else"checkbox"==h.getAttribute("type")?f=h.checked:"select"==h.getAttribute("type")?(f=0,0<=h.selectedIndex&&h.selectedIndex<h.options.length&&(f=h.selectedIndex),f=h[f]?
h[f].value:h.options[0].value):"button"!=h.getAttribute("type")&&(f=h.value);m&&ra(m,f,b&&b.reload)}b&&b.reload&&window.location.reload()}},!1));return c},Ja=function(a){var b=function(a,b,c,d,g){var f=k("th","settingsth",a.name,a.id,b),h=k("a","settingsth_a",a.name,a.id,b+"_a");h.setAttribute("name","settingsth_a"+a.name);var m=k("a","settingsth_a_up",a.name,a.id,b+"_a_up");m.setAttribute("name","settingsth_a_up"+a.name);var l=k("a","settingsth_a_down",a.name,a.id,b+"_a_down");l.setAttribute("name",
"settingsth_a_down"+a.name);var e=function(){for(var b=document.getElementsByName("settingsth_a_up"+a.name),d=document.getElementsByName("settingsth_a_down"+a.name),c=0;c<b.length;c++)b[c].style.display="none";for(c=0;c<d.length;c++)d[c].style.display="none";"up"==U()?m.style.display="":l.style.display=""},s=function(){e()};b=function(){window.setTimeout(function(){if(R()==d){var a="down"==U()?"up":"down";localStorage.setItem("sort_sequence",a)}else localStorage.setItem("sort_key",d);Ca(s)},1)};f.inserted||
(f.appendChild(h),f.appendChild(l),f.appendChild(m),h.addEventListener("click",b),m.addEventListener("click",b),l.addEventListener("click",b),h.textContent=c+" ",h.href="#",m.innerHTML="&#x25B4;",m.href="#",l.innerHTML="&#x25BE;",l.href="#");g&&!R()?(localStorage.setItem("sort_key",d),localStorage.setItem("sort_sequence","up"),window.setTimeout(e,1)):d==R()&&window.setTimeout(e,1);return f},c,d,g,f,h;f=r("tbody",a.name,a.id,"body");h=r("thead",a.name,a.id,"head");if(a.scriptTab){var m=Ia(a);c=k("table",
"scripttable",a.name,a.id,"main");var l=k("th","script_sel",a.name,a.id,"thead_sel");l.appendChild(m.selAllm);g=k("tr","multiselect settingstr filler",a.name,a.id,"filler_multi");var s=k("th","",a.name,a.id,"thead_multi");s.setAttribute("colspan","9");s.appendChild(m.actionBox);$(g).hide();g.setAttribute("name","multiselectcol");g.appendChild(l);g.appendChild(s);l=k("th","script_sel",a.name,a.id,"thead_sel");l.appendChild(m.selAll);var m=b(a,"thead_en","#","pos"),s=b(a,"thead_name",e.getMessage("Name"),
"name",!0),p=b(a,"thead_ver",e.getMessage("Version"),"ver"),A=k("th","settingsth",a.name,a.id,"thead_type");A.textContent=e.getMessage("Type");var n=k("th","settingsth",a.name,a.id,"thead_sync");n.textContent="";var y=b(a,"thead_sites",e.getMessage("Sites"),"sites");y.width="25%";var F=k("th","settingsth",a.name,a.id,"thead_features");F.textContent=e.getMessage("Features");var J=b(a,"thead_homepage",e.getMessage("Homepage"),"homepage"),b=b(a,"thead_updated",e.getMessage("Last_Updated"),"updated"),
x=k("th","settingsth",a.name,a.id,"thead_sort"),v=k("span","sorting",a.name,a.id,"thead_sort_span");v.textContent=e.getMessage("Sort");"pos"==R()&&"up"==U()||v.setAttribute("style","display: none;");x.appendChild(v);v=k("th","settingsth",a.name,a.id,"thead_del");v.textContent=e.getMessage("Actions");z.push(function(){w.sync_enabled&&(n.textContent=e.getMessage("Imported"))});d=k("tr","settingstr filler",a.name,a.id,"filler");d.setAttribute("style","height: 36px;");d.setAttribute("name","multiselectcol_hide");
t.each([l,m,s,p,A,n,y,F,J,b,x,v],function(a,b){d.appendChild(a)});h.appendChild(g);h.appendChild(d);h.setAttribute("name","multiselectrow");d.inserted||(q.multiselect.checkScroll=function(a){a=$(h).is(":visible")&&$(g).is(":visible")&&$(window).scrollTop()>$(h).offset().top;$(g).toggleClass("multi_scrolling",a)},$(window).scroll(q.multiselect.checkScroll))}else c=k("table","settingstable",a.name,a.id,"main"),d=k("tr","settingstr filler",a.name,a.id,"filler"),f.appendChild(d);c.appendChild(h);c.appendChild(f);
return{table:c,head:h,body:f}},Da=function(a,b,c,d){var g=[],f=function(){[0,1].forEach(function(){g.unshift(null)})};if(b.divider)return null;b.image&&(b.imageURL=O.get(b.image));if(b.checkbox){f=function(){var a=!0;this.warning&&(a=Z(this.warning),a||(this.checked=!this.checked));a&&(ra(this.key,this.checked,this.reload),this.reload&&window.location.reload())};c&&c.need_save&&(f=m=null);var h=n.createCheckbox(b.name,b,f);g.push(h.elem)}else if(b.button)h=n.createButton(b.name,b,function(){var a=
!0;this.warning&&(a=Z(this.warning));a&&Ka(this.key,!0,this.ignore,this.reload)}),g.push(h);else if(b.input)h=n.createTextarea(b.name,b),g.push({element:h.elem,validation:h.label}),c&&(c.need_save=!0);else if(b.text)h=n.createInput(b.name,b),g.push(h.elem),c&&(c.need_save=!0);else if(b.password)h=n.createPassword(b.name,b),g.push(h.elem),c&&(c.need_save=!0);else if(b.select){var m=function(){var a=!0;this.warning&&(a=Z(this.warning),a||(this.value=this.oldvalue));a&&(ra(this.key,this.value,this.reload),
this.reload&&window.location.reload())};c&&c.need_save&&(m=b.enabler?function(){var a=document.getElementsByName("enabled_by_"+this.key),b=(this.selectedIndex<this.options.length?this.options[this.selectedIndex]:this.options[0]).getAttribute("enables"),c=b?JSON.parse(b):{};t.each(a,function(a){void 0===c[a.key]||c[a.key]?a.setAttribute("style",t.staticVars.visible):a.setAttribute("style",t.staticVars.invisible)})}:null);h=n.createDropDown(b.name,b,b.select,m,function(){var a=!0;this.selectedOptions.length&&
this.selectedOptions[0].warning&&this.selectedOptions[0].value!==this.oldvalue&&(a=Z(this.selectedOptions[0].warning),a||(this.value=this.previousValue||this.oldvalue));this.previousValue=this.value});g.push(h.elem);a&&b.enabler&&function(){var a=m,b=h;z.push(function(){a.apply(b.select,[])})}()}else if(b.url){var l=r("a",b.name,b.id);l.href="#";l.url=b.url;l.newtab=b.newtab;l.inserted||(m=function(){ta(this.url,this.newtab)},l.addEventListener("click",m));l.textContent=b.name;g.push(l);f()}else if(b.main_menu_item){f=
r("span",b.name,b.id);f.textContent=b.name;var l=Ja(b),e=r("div",b.name,b.id,"tab_content");e.appendChild(l.table);var p=null,f=d.appendTab(b.id,f,e,function(){p&&(Y.global?p():z.push(p))});b.referrer&&(p=function(){p=null;u.wait();da({referrer:b.referrer},function(b){b.items&&b.items.forEach(function(b){Da(a,b,c,d)});qa();u.hide()})});b.items&&ea(l.body,b.items,null,d);Y.global||!b.selected_default||Q.selected||f.select()}else if(b.sub_menu_item)l=k("div","section",b.name,b.id),f=k("div","section_head",
b.name,b.id,"head"),e=k("table","section_content",b.name,b.id,"content"),f.textContent=b.name,l.appendChild(f),b.desc&&n.setHelp(b.desc,f,f,b),l.appendChild(e),ea(e,b.items,b,d),b.need_save&&e.appendChild(ma(e,b)),g.push(l);else if(b.userscript||b.nativeScript||b.user_agent){g=La(b,a,d);if(b.userscript||b.user_agent)P[b.uuid]={dom:a,script:b};a.setAttribute("class","scripttr");b.nnew?a.setAttribute("style","display: none;"):pa.is("script_refresh")||(z.push(function(){ua.init(t.map(P,function(a){return a.script}));
q.multiselect.single_click();Ca();Y.scripts=!0;pa.clear()}),pa.add("script_refresh"))}else b.version?(oa=b.value,k("div","version","version","version").textContent="v"+oa+" by Jan Biniok"):b.globalhint?Ea({text:b.value,title:b.description,onclick:b.info_url?function(){ta(b.info_url,!0)}:null,image:b.image}):(l=r("span","",b.uuid||b.id+b.name),l.textContent=b.name,g.push(l),f());g.forEach(function(a){if(a){void 0!==b.level&&(a.element||a).setAttribute("style",b.level>w.configMode?t.staticVars.invisible:
t.staticVars.visible||"");if(b.hint){var c=r("span","",b.uuid||b.id+b.name,"hint");c.textContent=b.hint;a.appendChild(c)}b.validation&&Ma(b,a.validation||a.element||a);b.width&&a.setAttribute("class","width-172-"+b.width)}});a&&(e=a.getAttribute("class"),f=" hide",!1===b.visible?e=(e||"")+f:e&&(e=e.replace(f,"")),a.setAttribute("class",e));return g},ea=function(a,b,c,d){for(var g in b){var f=b[g],h=a?r("tr","",f.uuid||f.id+f.name,"pi"):null,m=Da(h,f,c,d);m&&m.length&&(a&&a.appendChild(h),t.each(m,
function(a,b){var c=a,d="";"Object"===t.toType(a)&&(c=a.element,d=a.style);d=k("td",d,"",f.uuid||f.id+f.name,b);a&&d.appendChild(c);h&&h.appendChild(d)}))}},Z=function(a){if(a.once){if(Aa[a.msg])return!0;Aa[a.msg]=!0}var b=confirm(a.msg),c={};b&&a.ok?c=a.ok:!b&&a.cancel&&(c=a.cancel);if(a.ok||a.cancel)b=!0;c.url&&sendMessage({method:"newTab",url:c.url},function(a){});return b},Ma=function(a,b){var c;a.validation&&(a.validation.url&&(c=function(){ta(this.url,!0)}),a.validation.image&&(a.validation.imageURL=
O.get(a.validation.image)),c=n.createAfterIcon(a,c))&&(c.url=a.validation?a.validation.url:void 0,b.appendChild(c))},Na=function(a){return{source:a.code,meta:{name:a.name,uuid:a.uuid,modified:a.lastModified,file_url:a.file_url&&a.file_url.trim()?a.file_url:void 0},storage:a.storage,options:a.options,settings:{enabled:a.enabled,position:a.position}}},fa=function(a,b){var c=M(),d=[];Oa(a,b).done(function(a){a.scripts.forEach(function(a){!a.uuid||!a.userscript&&!a.user_agent||a.system||a.nnew||(a.code&&
""!=a.code.trim()?d.push(Na(a)):console.log("options: Strange script: "+a.name))});c.resolve(d)}).fail(function(){c.reject()});return c.promise()},Qa=function(a){var b=r("div","utils","utils","tab_util_h");b.textContent=e.getMessage("Utilities");var c=r("div","utils","utils","tab_util");a.appendTab("util_tabutils",b,c).show();a=k("div","tv_util","utils","utils","tab_util_cont");var d=function(a){var b=M(),c=new FileReader;c.onload=function(a){b.resolve(a.target.result)};c.readAsText(a);return b.promise()},
g=n.createButton("utils","utils_i_ta",e.getMessage("Import"),function(){N.json.read(A.value).then(function(a){return va(a,{reload:!0})}).done(function(a){a.err&&t.alert(a.err)}).fail(function(){t.alert(e.getMessage("Unable_to_parse_this_"))})}),f=n.createFileSelect(e.getMessage("Import"),{name:"zip",id:"utils"},function(a){u.wait();for(var b=0,c;c=a[b];b++)N.zip.read(c).progress(function(a){u.wait(Math.floor(a.item/a.of*100)+"%")}).then(function(a){return va({scripts:t.map(a,function(a){var b=a.meta||
{},c=a.settings||{};return{source:a.source,name:b.name,uuid:b.uuid,file_url:b.file_url,options:a.options,storage:a.storage,lastModified:b.modified,enabled:c.enabled,position:c.position}})},{reload:!0})}).done(function(a){a.err&&t.alert(a.err)}).fail(function(){t.alert(e.getMessage("Unable_to_parse_this_"))}).always(u.hide)}),h=n.createFileSelect(e.getMessage("Import"),{name:"file",id:"utils"},function(a){for(var b=0,c;c=a[b];b++)d(c).then(function(a){return N.json.read(a)}).then(function(a){return va(a,
{reload:!0})}).done(function(a){a.err&&t.alert(a.err)}).fail(function(){t.alert(e.getMessage("Unable_to_parse_this_"))})}),b=n.createButton("utils","utils_i_url",e.getMessage("Import"),function(){u.wait();return Pa(J.value,{reload:!0}).fail(function(a){a=a.err?a.err:e.getMessage("Unable_to_parse_this_");t.alert(a)}).always(u.hide)}),m=n.createButton("utils","utils_e_ta",e.getMessage("Export"),function(){fa(null,{storage:T}).then(function(a){return N.json.create(a)}).done(function(a){A.value=a})}),
l=n.createButton("utils","utils_e_file",e.getMessage("Export"),function(){fa(null,{storage:T}).then(function(a){return N.json.download(a)})}),s=n.createButton("utils","utils_e_zip",e.getMessage("Export"),function(){fa(null,{storage:T}).then(function(a){u.wait();return N.zip.download(a).progress(function(a){u.wait(Math.floor(a.item/a.of*100)+"%")})}).always(function(){u.hide()})}),p=n.createCheckbox(e.getMessage("Include_script_storage"),{id:"utils_e_data_zip",enabled:"true"},function(){T=this.checked});
p.elem.setAttribute("style","padding-left: 15px; display: inline");p.input.checked=T;var A=k("textarea","importta","utils","utils","ta"),I=k("div","section","utils","utils","ta"),y=k("div","section_head","utils","utils","head_ta"),F=k("div","section_content","utils","utils","content_ta");y.textContent=e.getMessage("General");F.appendChild(p.elem);I.appendChild(y);I.appendChild(F);p=k("div","section","utils","utils","ta");y=k("div","section_head","utils","utils","head_ta");F=k("div","section_content",
"utils","utils","content_ta");y.textContent=e.getMessage("TextArea");F.appendChild(m);F.appendChild(g);F.appendChild(A);p.appendChild(y);p.appendChild(F);g=k("div","section","utils","utils","sb");m=k("div","section_head","utils","utils","head_sb");y=k("div","section_content","utils","utils","content_sb");m.textContent=e.getMessage("Zip");g.appendChild(m);g.appendChild(y);y.appendChild(s);y.appendChild(f.elem);f=k("div","section","utils","utils","fi");s=k("div","section_head","utils","utils","head_fi");
m=k("div","section_content","utils","utils","content_fi");s.textContent=e.getMessage("File");f.appendChild(s);f.appendChild(m);m.appendChild(l);m.appendChild(h.elem);var J=k("input","updateurl_input","utils","utils","url"),h=k("div","section","utils","utils","ur"),l=k("div","section_head","utils","utils","head_ur"),s=k("div","section_content","utils","utils","content_ur");l.textContent=e.getMessage("URL");h.appendChild(l);h.appendChild(s);s.appendChild(J);s.appendChild(b);a.appendChild(I);ca.RUNTIME.CAN_SAVEAS_ZIP&&
a.appendChild(g);"undefined"!==typeof Blob&&a.appendChild(f);a.appendChild(p);a.appendChild(h);t.each([p],function(a){var b=a.getAttribute("class"),b=50>w.configMode?b+" hide":b.replace(" hide","");a.setAttribute("class",b)});c.appendChild(a)},Ra=function(){var a=document.getElementById("options"),b=k("div","main_container p100100","options","main");if(a){var c=a.parentNode;c.removeChild(a);c.appendChild(b);document.body.setAttribute("class","main")}var a=k("div","head_container","opt","head_container"),
c=k("div","tv_container","opt","tv_container"),d=r("a","head_link","heads","head_link");d.href="http://tampermonkey.net";d.target="_blank";var g=k("div","float margin4","heads","head1"),f=k("img","banner","heads");f.src=rea.extension.getURL("images/icon128.png");var h=k("div","float head margin4","heads","head2"),m=r("div","heads"),e=k("div","version","version","version");e.textContent=" by Jan Biniok";var s=r("div","search","box","");m.textContent="Tampermonkey";g.appendChild(f);h.appendChild(m);
h.appendChild(e);d.appendChild(g);d.appendChild(h);a.appendChild(d);a.appendChild(s);b.appendChild(a);b.appendChild(c);var p=ia.create("_main",c);z.push(function(){Qa(p);if(Q.selected){var a=p.getTabById(Q.selected);a&&a.select()}Y.global=!0})},W=function(a,b,c){var d=b.item,g=d.uuid+b.id,f=(c?"orig_":"use_")+b.id,h=function(a){return"select_"+t.createUniqueId(a,d.uuid)+"_sel1"},m=k("div","cludes",a,g,"cb1");if(document.getElementById(h(f)))return{elem:m};var l=r("span",d.name,g,"cb2");if(c){var s=
"merge_"+b.id;a=n.createCheckbox(a,{id:s,uuid:d.uuid,enabled:d.options&&d.options.override&&d.options.override[s]?!0:!1},function(){if("checkbox"==this.type){var a={};a[this.key]=!this.oldvalue;V(this.uuid,a)}});l.appendChild(a.elem)}else l.textContent=a;a=d.options&&d.options.override&&d.options.override[f]?d.options.override[f]:[];var p=k("select","cludes",f,d.uuid,"sel1");p.setAttribute("size","6");p.setAttribute("multiple","true");for(f=0;f<a.length;f++)s=document.createElement("option"),s.value=
s.text=a[f],p.appendChild(s);m.appendChild(l);d.desc&&n.setHelp(d.desc,m,l,d);m.appendChild(p);var A=function(a){var b=[];a=a&&a.options;for(var c=0,d=a.length;c<d;c++)a[c].selected&&b.push(a[c]);return b};a=function(){var a=h("use_"+("excludes"==b.id?"includes":"excludes")),c=document.getElementById(a),a=A(p),d=!1,g="matches"==b.id;a.forEach(function(a){var b=g?"/"+la.getRegExpFromMatch(a.value)+"/":a.value;a&&!c.querySelector('option[value="'+b+'"]')&&(a=a.cloneNode(!0),g&&(a.value=b,a.textContent=
b),c.appendChild(a),d=!0)});d&&y()};var s=function(){var a=prompt(e.getMessage("Enter_the_new_rule"));if(a){var b=document.createElement("option");b.value=b.text=a.trim();p.appendChild(b);y()}},f=function(){var a=p.options[p.selectedIndex];if(a){var b=prompt(e.getMessage("Enter_the_new_rule"),a.value);b&&(a.value=a.text=b.trim(),y())}},l=function(){var a=!1;A(p).forEach(function(b){b&&(b.parentNode.removeChild(b),a=!0)});a&&y()},I=function(a){for(var b=[],c=0;c<a.options.length;c++)b.push(a.options[c].value);
return b},y=function(){var a={includes:I(document.getElementById(h("use_includes"))),matches:I(document.getElementById(h("use_matches"))),excludes:I(document.getElementById(h("use_excludes")))};V(d.uuid,a);return!0};c?(g=r("button",d.name,g,"btn1"),g.textContent=e.getMessage("Add_as_0clude0",c),g.addEventListener("click",a,!1)):(c=r("button",d.name,g,"btn2"),c.textContent=e.getMessage("Add")+"...",c.addEventListener("click",s,!1),m.appendChild(c),c=r("button",d.name,g,"btn3"),c.textContent=e.getMessage("Edit")+
"...",c.addEventListener("click",f,!1),m.appendChild(c),g=r("button",d.name,g,"btn4"),g.textContent=e.getMessage("Remove"),g.addEventListener("click",l,!1));m.appendChild(g);return{elem:m}},wa=function(a){return a.homepage?a.homepage:a.namespace&&0==a.namespace.search(/https?:\/\//)?a.namespace:null};ka.create("sites").setOptions({timeout:600,check_interval:300,retimeout_on_get:!0}).init();var ua=function(){var a={},b=function(a){return 7>a.toString().length?b("0"+a):a},c=function(a){if(a.includes||
a.matches){for(var b={},c=[],h=a.includes.length?a.includes:a.matches,m=0;m<h.length;m++){var e=h[m];if(e){var k=ka.items.sites.get(e),p=void 0!==k?k:n.getInfoFromUrl(e);void 0===k&&ka.items.sites.set(e,p);p&&p.dom?b[p.dom]||(b[p.dom]=!0,c.push({include:e,info:p})):c.push({include:e})}else console.log("o: Warn: script '"+a.name+"' has invalid include (index: "+m+")")}return c}};return{init:function(b){a={};b.forEach(function(b){(b=c(b))&&b.length&&b.forEach(function(b){b.info&&(a[b.info.dom]=(a[b.info.dom]||
0)+1)})})},get:function(d){d=c(d);if(!d||!d.length)return b(0);d=t.map(d,function(b){return b.info?{score:1E3*a[b.info.dom]+b.info.dom.charCodeAt(0)||0,dom:b.info.dom}:{score:0,dom:""}}).sort(function(a,b){return b.score-a.score})[0];return b(d.score)+d.dom},topIcons:function(b,g){var f=[],h=c(b);if(!h||!h.length)return[];h=t.map(h,function(b){b.score=b.info?a[b.info.dom]||0:0;return b}).sort(function(a,b){return b.score-a.score});t.each(h,function(a){var c=a.info;if(0==g--)return a=k("span","",b.uuid,
"tbc"),a.textContent="...",f.push(a),!1;if(c){if("*"==c.tld)return a=n.createImage(rea.extension.getURL("/layout/default/images/web.png"),"",b.uuid,a.include,a.include),f.push(a),!1;var h="com",e="";"*"!=c.tld&&"tld"!=c.tld&&(h=c.tld);c.subdom.length&&(e=c.subdom.join(".")+".");var A=("chrome://favicon/http://"+e+c.dom+"."+h+"/").replace(/\*/g,""),c=("http://"+e+c.dom+"."+h+"/favicon.ico").replace(/\*/g,""),A=[c,A];if(0==c.search("http://userscripts.org/")||0==c.search("http://userscripts.com/"))A=
O.origin("uso");a=n.createFavicon(A,"",b.uuid,a.include,a.include)}else a=n.createFavicon("?","",b.uuid,a.include,a.include);f.push(a)});return f}}}(),R=function(){return localStorage.getItem("sort_key")},U=function(){return localStorage.getItem("sort_sequence")},Ca=function(a){var b=function(a,c){return a.tagName==c?a:a.parentNode?b(a.parentNode,c):null},c=null,d=[],g=0,f=(new Date).getTime(),h;for(h in P){var m=P[h];if(m){var l=b(m.dom,"TR");if(l){var k=b(l,"TBODY");c?k&&c!=k&&console.warn("options: different parents?!?!"):
c=k;g++;k=f-parseInt(m.script.lastUpdated);isNaN(k)&&(k=0);var p=parseInt(m.script.version);isNaN(p)&&(p=0);d.push({tr:l,sites:ua.get(m.script),position:m.script.position?m.script.position:1E3+g,name:e.getTranslation(m.script,"name").toLowerCase(),homepage:[m.script.origin?la.parse(m.script.origin.url).hostname:"z",wa(m.script)?la.parse(wa(m.script)).hostname:"z"].join("_"),updated:k,version:p});l.inserted=!1;l.parentNode&&l.parentNode.removeChild(l)}else console.log("options: unable to sort script at pos "+
m.pos)}else console.warn("options: something went wrong!",h)}d=function(a){var b;b=function(a){return function(b,c){return b[a]-c[a]}};var c=function(a){return function(b,c){return b[a]<c[a]?-1:b[a]>c[a]?1:0}},d=R();b="pos"==d?b("position"):"ver"==d?b("version"):"updated"==d?b("updated"):c(d);a.sort(b);return a}(d);"down"==U()&&(d=d.reverse());for(f=0;f<g;f++)c.appendChild(d[f].tr);$(".sorting").each(function(a,b){var c=$(b),d="pos"==R()&&"up"==U();c[d?"fadeIn":"fadeOut"]()});a&&a()},Va=function(a,
b,c,d,g){var f=k("div","",b.name,b.uuid,"script_tab_head");c=f.inserted;var h=k("div","heading",b.uuid,"heading"),m=k("img","nameNicon64",b.uuid,"heading_icon"),l=b.icon64?b.icon64:b.icon;m.src=l;var s=k("div","nameNname64",b.uuid,"heading_name");s.textContent=e.getTranslation(b,"name");l&&h.appendChild(m);h.appendChild(s);m=k("div","author",b.uuid,"author");b.author?m.textContent="by "+b.author:b.copyright&&(m.innerHTML="&copy; ",m.textContent+=b.copyright);var l=k("table","noborder p100100",b.uuid,
"table"),s=k("tr","script_tab_head",b.uuid,"tr1"),p=k("tr","details",b.uuid,"tr2"),n=k("td","",b.uuid,"td1"),r=k("td","",b.uuid,"td2");h.appendChild(m);f.appendChild(h);n.appendChild(f);s.appendChild(n);p.appendChild(r);l.appendChild(s);l.appendChild(p);d.appendChild(l);d=ia.create("_details"+t.createUniqueId(b.name,b.uuid),r,{tv:"tv tv_alt",tv_table:"tv_table tv_table_alt",tr_tabs:"tr_tabs tr_tabs_alt",tr_content:"tr_content tr_content_alt",td_content:"td_content td_content_alt",td_tabs:"td_tabs td_tabs_alt",
tv_tabs_align:"tv_tabs_align tv_tabs_align_alt",tv_tabs_fill:"tv_tabs_fill tv_tabs_fill_alt",tv_tabs_table:"tv_tabs_table tv_tabs_table_alt",tv_contents:"tv_contents tv_contents_alt",tv_tab_selected:"tv_tab tv_selected tv_tab_alt tv_selected_alt",tv_tab_close:"",tv_tab:"tv_tab tv_tab_alt",tv_content:"tv_content tv_content_alt"});var y=Sa(b,d,g),u=b.nnew||b.system?{}:Ta(b,d),q=b.nnew||b.system||!b.requires.length&&!b.resources.length?{}:Ua(b,d);if(c)return S["tab"+b.uuid];var x=function(b){var c=!1;
if("keydown"==b.type&&(27==b.keyCode&&"windows"==w.editor_keyMap&&"textarea"!==b.srcElement.tagName.toLowerCase()&&(a.isSelected()&&window.setTimeout(g,1),c=!0),c))return b.stopPropagation(),b.preventDefault(),!1};d={onShow:function(){t.each([u,y,q],function(a){if(a.onShow)a.onShow()});window.addEventListener("keydown",x,!1)},onClose:function(a){var b;t.each([u,y,q],function(c){if(c.onClose&&c.onClose(a))return b=!0,!1});b||window.removeEventListener("keydown",x,!0);return b},afterSelect:function(){t.each([u,
y,q],function(a){a.afterSelect&&a.afterSelect()})}};return S["tab"+b.uuid]=d},Ta=function(a,b){var c=r("div",a.name,a.uuid,"script_setting_h"),d=r("div",a.name,a.uuid,"script_settings_c");c.textContent=e.getMessage("Settings");var g=function(){if("checkbox"==this.type||"button"==this.type){var a={};a[this.key]=!this.oldvalue;V(this.uuid,a)}else if("text"==this.type||"textarea"==this.type||"select-one"==this.type){var b=this.value;if("native"===this.valtype)if("undefined"===b)b=void 0;else if("null"===
b)b=null;else try{b=JSON.parse(b)}catch(c){}a={};a[this.key]=b;V(this.uuid,a)}},f=n.createPosition(e.getMessage("Position_")+": ",{id:"position",uuid:a.uuid,name:a.name,pos:a.position,posof:a.positionof},g),h=n.createDropDown(e.getMessage("Run_at"),{id:"run_at",uuid:a.uuid,name:a.name,value:a.run_at},[{name:"document-start",value:"document-start"},{name:"document-body",value:"document-body"},{name:"document-end",value:"document-end"},{name:e.getMessage("Default"),value:null}],g),m=n.createDropDown(e.getMessage("No_frames"),
{id:"noframes",uuid:a.uuid,name:a.name,value:a.noframes},[{name:e.getMessage("Yes"),value:!0},{name:e.getMessage("No"),value:!1},{name:e.getMessage("Default"),value:null}],g),l=W(e.getMessage("Original_includes"),{id:"includes",item:a},e.getMessage("User_excludes")),s=W(e.getMessage("Original_matches"),{id:"matches",item:a},e.getMessage("User_excludes")),p=W(e.getMessage("Original_excludes"),{id:"excludes",item:a},e.getMessage("User_includes")),A=k("div","clear",a.name,a.uuid,"clear"),t=W(e.getMessage("User_includes"),
{id:"includes",item:a}),y=W(e.getMessage("User_matches"),{id:"matches",item:a}),u=W(e.getMessage("User_excludes"),{id:"excludes",item:a}),q=n.createCheckbox(e.getMessage("Apply_compatibility_options_to_required_script_too"),{id:"compatopts_for_requires",uuid:a.uuid,name:a.name,enabled:a.compatopts_for_requires},g),x=n.createCheckbox(e.getMessage("Fix_wrappedJSObject_property_access"),{id:"compat_wrappedjsobject",uuid:a.uuid,name:a.name,enabled:a.compat_wrappedjsobject},g),v=n.createCheckbox(e.getMessage("Convert_CDATA_sections_into_a_chrome_compatible_format"),
{id:"compat_metadata",uuid:a.uuid,name:a.name,enabled:a.compat_metadata},g),w=n.createCheckbox(e.getMessage("Replace_for_each_statements"),{id:"compat_foreach",uuid:a.uuid,name:a.name,enabled:a.compat_foreach},g),C=n.createCheckbox(e.getMessage("Fix_for_var_in_statements"),{id:"compat_forvarin",uuid:a.uuid,name:a.name,enabled:a.compat_forvarin},g),D=n.createCheckbox(e.getMessage("Convert_Array_Assignements"),{id:"compat_arrayleft",uuid:a.uuid,name:a.name,enabled:a.compat_arrayleft},g),E=n.createCheckbox(e.getMessage("Add_toSource_function_to_Object_Prototype"),
{id:"compat_prototypes",uuid:a.uuid,name:a.name,enabled:a.compat_prototypes},g),q=[q,x,v,w,C,D,E],x=k("div","section",a.name,a.uuid,"ta_opt"),w=k("div","section_head",a.name,a.uuid,"head_ta_opt"),v=k("div","section_content",a.name,a.uuid,"content_ta_opt");w.textContent=e.getMessage("Settings");x.appendChild(w);x.appendChild(v);w=k("div","section",a.name,a.uuid,"ta_cludes");C=k("div","section_head",a.name,a.uuid,"head_ta_cludes");E=k("div","section_content",a.name,a.uuid,"content_ta_cludes");C.textContent=
e.getMessage("Includes_Excludes");w.appendChild(C);w.appendChild(E);var C=k("div","section",a.name,a.uuid,"ta_compat"),z=k("div","section_head",a.name,a.uuid,"head_ta_compat"),D=k("div","section_content",a.name,a.uuid,"content_ta_compat");z.textContent=e.getMessage("GM_compat_options_");C.appendChild(z);C.appendChild(D);v.appendChild(f);a.user_agent||v.appendChild(h.elem);v.appendChild(m.elem);E.appendChild(l.elem);E.appendChild(s.elem);E.appendChild(p.elem);E.appendChild(A);E.appendChild(t.elem);
E.appendChild(y.elem);E.appendChild(u.elem);f=r("div",a.name,a.uuid,"tab_content_settings");f.appendChild(x);f.appendChild(w);if(!a.user_agent){for(h=0;h<q.length;h++)D.appendChild(q[h].elem);if(a.awareOfChrome)for(var aa in q)q[aa].input.setAttribute("disabled","disabled"),q[aa].elem.setAttribute("title",e.getMessage("This_script_runs_in_Chrome_mode"));f.appendChild(C)}var sa=n.createTextarea(null,{name:a.name,uuid:a.uuid,id:"comment",value:a.options.comment});sa.elem.setAttribute("class","script_setting_wrapper");
aa=r("div",a.name,a.uuid,"save");h=n.createButton(a.name,a.uuid,e.getMessage("Save"),function(){g.apply(sa.textarea,[])});aa.appendChild(h);h=k("div","section",a.name,a.uuid,"ta_comment");m=k("div","section_head",a.name,a.uuid,"head_ta_comment");l=k("div","section_content",a.name,a.uuid,"content_ta_comment");m.textContent=e.getMessage("Comment");h.appendChild(m);h.appendChild(l);l.appendChild(sa.elem);l.appendChild(aa);f.appendChild(h);d.appendChild(f);b.appendTab("script_settings_tab"+a.uuid,c,d);
return{}},Fa=function(a,b){var c=k("table","script_desc",a.name,a.uuid,"outer_req2html"),d=0,g=[{label:e.getMessage("URL"),prop:"url"},{label:e.getMessage("Size"),prop:"data",fn:function(a){var b="?";a&&(void 0!==a.length?b=a.length:void 0!==a.content&&(b=a.content.length));return b+" Bytes"}},{label:e.getMessage("Last_updated"),prop:"ts",fn:function(a){return a?(new Date(a)).toString():"?"}}];a[b].forEach(function(f){var h=d+b;g.forEach(function(b){var d=k("tr","external_desc",a.uuid,b.prop,"tr"+
h),g=k("td","external_desc",a.uuid,b.prop,"td1"+h),e=k("td","",a.uuid,b.prop,"td2"+h);g.textContent=b.label;e.textContent=(b.fn?b.fn:function(a){return a})(f[b.prop]);d.appendChild(g);d.appendChild(e);c.appendChild(d)});var s=k("tr","external_desc_buttons",a.uuid,f.url,"tr"+h),p=k("td","",a.uuid,"buttons","td"+h);s.appendChild(p);c.appendChild(s);if(f.ts){var s=r("div",a.name,a.uuid,"delete_external"+h),q=n.createButton(a.uuid,"delete_external"+t.createUniqueId(f.url)+h,e.getMessage("Delete"),function(){Wa(a.uuid,
f.url);q.parentNode&&q.parentNode.removeChild(q)});s.appendChild(q);p.appendChild(s)}d++});if(!d){var f=k("tr","script_desc",a.uuid,d,"tr"),h=k("td","script_desc",a.uuid,d,"td1");h.textContent=e.getMessage("No_entry_found");f.appendChild(h);c.appendChild(f)}return c},Ua=function(a,b){var c=r("div","",a.uuid,"script_external_h");c.textContent=e.getMessage("Externals");var d=r("div","",a.uuid,"script_externals_c"),g=k("div","section",a.name,a.uuid,"ta_requires"),f=k("div","section_head",a.name,a.uuid,
"head_ta_requires"),h=k("div","section_content",a.name,a.uuid,"content_ta_requires");f.textContent=e.getMessage("Requires");g.appendChild(f);g.appendChild(h);h.appendChild(Fa(a,"requires"));var f=k("div","section",a.name,a.uuid,"ta_resources"),h=k("div","section_head",a.name,a.uuid,"head_ta_resources"),m=k("div","section_content",a.name,a.uuid,"content_ta_resources");h.textContent=e.getMessage("Resources");f.appendChild(h);f.appendChild(m);m.appendChild(Fa(a,"resources"));h=r("div","",a.uuid,"tab_content_settings");
h.appendChild(g);h.appendChild(f);d.appendChild(h);b.appendTab("script_externals_tab"+a.uuid,c,d);return{}},Sa=function(a,b,c){var d=k("tr","editor_container p100100",a.name,a.uuid,"container");if(!a.nnew&&H(a.uuid,"lastI"))return[];a.nnew&&(a.code=a.code.replace("<$URL$>",Q.url||"http://*/*"));var g=r("div",a.name,a.uuid,"script_editor_h"),f=g.inserted;g.textContent=e.getMessage("Editor");var h=r("div",a.name,a.uuid,"script_editor_c"),m=k("tr","editormenubar",a.name,a.uuid,"container_menu"),l=k("table",
"editor_container_o p100100 noborder",a.name,a.uuid,"container_o");l.appendChild(m);l.appendChild(d);h.appendChild(l);var s=function(b){H(a.uuid,"saveEm")},p=function(a,b,d){c&&c(b,d)},l=n.createImageButton(a.uuid,"save_to_disk",e.getMessage("Save_to_disk"),rea.extension.getURL("/layout/default/images/harddrive2.png"),function(b){b=d.editor&&w.editor_enabled?d.editor.mirror.getValue():v.value;u.wait();N.plain.download(a.name,b).always(function(){u.hide()})}),A=n.createImageButton(a.uuid,"save",e.getMessage("Save"),
rea.extension.getURL("/layout/default/images/filesave.png"),s),I=n.createImageButton(a.uuid,"cancel",e.getMessage("Editor_reset"),rea.extension.getURL("/layout/default/images/editor_cancel.png"),function(){confirm(e.getMessage("Really_reset_all_changes_"))&&(d.editor&&w.editor_enabled?d.editor.mirror.setValue(a.code):v.textContent=a.code)}),y=n.createImageButton(a.uuid,"reset",e.getMessage("Full_reset"),rea.extension.getURL("/layout/default/images/script_cancel.png"),function(){xa(a.uuid,null,{old_url:x.input?
x.input.oldvalue:"",new_url:x.input?x.input.value:"",clean:!0,reload:!0}).done(function(a){a.cleaned&&p(null,!0,!1)});q[a.uuid].fullReset()}),F=n.createImageButton(a.uuid,"close_script",e.getMessage("Close"),rea.extension.getURL("/layout/default/images/exit.png"),p),J=n.createImageButton(a.uuid,"lint_script",e.getMessage("Run_syntax_check"),rea.extension.getURL("/layout/default/images/check.png"),function(){window.setTimeout(function(){d.editor&&w.editor_enabled&&(u.wait(),window.setTimeout(function(){ya.run(d.editor).always(u.hide)},
1))},1)}),x=n.createInput(e.getMessage("Update_URL_"),{id:"file_url",uuid:a.uuid,name:a.name,value:a.file_url});x.input.setAttribute("class","updateurl_input");x.elem.setAttribute("class","updateurl");var v=k("textarea","editorta",a.name,a.uuid);v.setAttribute("wrap","off");var z=k("td","editor_outer",a.name,a.uuid,"edit"),C=k("div","editor_100 editor_border",a.name,a.uuid,"edit"),D=k("div","editormenu",a.name,a.uuid,"editormenu");z.appendChild(C);m.appendChild(D);m.appendChild(x.elem);d.inserted||
(C.appendChild(v),d.appendChild(z));a.system||(q[a.uuid].saveEm=function(){var b=!0;w.showFixedSrc&&!a.user_agent&&(b=confirm(e.getMessage("Do_you_really_want_to_store_fixed_code_",e.getMessage("Show_fixed_source"))));var c=d.editor&&w.editor_enabled?d.editor.mirror.getValue():v.value;b&&xa(a.uuid,c,{old_url:x.input?x.input.oldvalue:"",new_url:x.input?x.input.value:"",clean:!1,new_script:a.nnew,reload:!0,lastModified:q[a.uuid].saveEm_lastModified}).done(function(b){b.installed?a.nnew||b.renamed?p(null,
!0,!1):(d.editor.changed=!1,b.lastModified&&(a.lastModified=b.lastModified)):b.aborted||(b.messages&&b.messages.errors&&b.messages.errors.length?t.alert(b.messages.errors.join("\n")):t.alert(e.getMessage("Unable_to_parse_this_")))});return b},D.appendChild(l),D.appendChild(A),D.appendChild(I));a.nnew||D.appendChild(y);D.appendChild(F);!a.system&&w.editor_enabled&&D.appendChild(J);b.appendTab("script_editor_tab"+a.uuid,g,h).select();if(f)return S["editor"+a.uuid];var E=function(){var b=!1;w.editor_enabled?
d.editor&&(b|=d.editor.changed&&d.editor.mirror.historySize().undo):b=v.value!=a.code;return b},B=function(){w.editor_autoSave&&E()&&H(a.uuid,"saveEm")};b={afterSelect:function(){d.editor&&d.editor.refresh()},onShow:function(){(function(){if(a.referrer&&void 0===a.code){var b=M();da({referrer:a.referrer,uuid:a.uuid},function(c){c.items?(a.code=c.items[0],b.resolve()):b.reject();u.hide()});return b.promise()}return M.Pledge()})().done(function(){var b=h.getElementsByTagName("textarea");q[a.uuid].lastI=
function(){return a};if(b.length&&!d.editor){var b=b[0],c=function(){d.editor&&(d.editor.changed=!0)};if(w.editor_enabled){var g=b.parentNode,f={search:e.getMessage("Search"),replace:e.getMessage("Replace"),jump:e.getMessage("Jump_to_line"),macro:e.getMessage("Insert_constructor"),reindentall:e.getMessage("Auto_Indent_all")};g.removeChild(b);d.editor=new MirrorFrame(g,{value:a.code,indentUnit:Number(w.editor_indentUnit),indentWithTabs:"tabs"==w.editor_indentWithTabs,smartIndent:"classic"!=w.editor_tabMode,
indentByTab:"indent"==w.editor_tabMode,electricChars:"true"==w.editor_electricChars.toString(),lineNumbers:!0,extraKeys:{Enter:"newlineAndIndentContinueComment"},keyMap:w.editor_keyMap,gutters:["gutter","CodeMirror-linenumbers"],matchBrackets:!0},{save:s,close:p},{change:c,blur:B},f)}else b.value=a.code}}).fail(function(){p(null,!1,!0)})},onClose:function(b){var c=function(){d.editor=null;delete q[a.uuid].lastI};if(!b&&E())return(b=confirm(e.getMessage("There_are_unsaved_changed_")))&&c(),!b;c();
return!1}};return S["editor"+a.uuid]=b},La=function(a,b,c){q[a.uuid]||(q[a.uuid]={});var d,g,f=a.icon&&!a.nativeScript,h=["script_name"];a.nativeScript||h.push("clickable");a.blacklisted&&h.push("crossedout");var m=k("span",h.join(" "),"",a.uuid,"sname"),l=k("img","nameNicon16 icon16","",a.uuid,"sname_img"),s=k("span",f?"nameNname16":"","",a.uuid,"sname_name"),p=wa(a),h=e.getTranslation(a,"name");s.textContent=35<h.length?h.substr(0,35)+"...":h;h=r("span","",a.uuid,"sversion");h.textContent=a.version?
a.version:"";f&&(l.src=a.icon,m.appendChild(l));var f=[],u=function(){d&&(d.remove(),d=null);delete S["tab"+a.uuid];delete S["editor"+a.uuid]},I=function(){window.setTimeout(function(){for(var d in P){var g=P[d].script;if(g.uuid==a.uuid){ea(b,[g],null,c);break}}qa()},1)},y=function(b,c){void 0===c&&(c=!b);a.uuid&&t.getUrlArgs(!0).open==a.uuid&&(window.location.hash="");g&&g.onClose&&g.onClose(b)||(u(),m.parentNode&&m.parentNode.removeChild(m),c&&I())},F=function(){g&&g.afterSelect&&g.afterSelect()},
J=function(f,h){if(!d){var m=null;a.nnew?(m=k("div","head_icon","",a.uuid,"details_h"),m.appendChild(n.createImage(a.imageURL,"",a.uuid,"new_script_head"))):m=k("div","","",a.uuid,"details_h");var l=r("div","",a.uuid,"details_c");d=c.insertTab(null,"details_"+a.uuid,m,l,F,a.nnew?null:y);a.nnew||d.setHeading(e.getMessage("Edit")+" - "+(25<a.name.length?a.name.substr(0,25)+"...":a.name));g=Va(d,a,b,l,y)}if(g&&g.onShow)g.onShow();d.show();f&&1==f.button||h||d.select();s.setAttribute("open","true");!a.nnew&&
a.uuid&&(window.location.hash="open="+a.uuid)};"true"==s.getAttribute("open")&&J(null,!0);var l=function(a,b){var c=a.getTime(),d=b.getTime(),g=Math.abs(c-d),c=Math.round(g/6E4),d=Math.round(g/36E5),g=Math.round(g/864E5);return 60>=c?c+" min":48>=d?d+" h":g+" d"},x=r("span","",a.uuid,"last_updated"),v="";if(a.nativeScript||a.nnew||a.system)v="";else if(s.inserted||(x.addEventListener("click",function(){H(a.uuid,"scriptUpdate")}),x.setAttribute("class","clickable"),x.title=e.getMessage("Check_for_Updates")),
q[a.uuid].scriptUpdate=function(){var b=x.textContent;x.textContent="";x.appendChild(n.createImage(rea.extension.getURL("/layout/default/images/download.gif"),"down",a.uuid));Xa(a.uuid,function(c){x.textContent=b;c?(x.style.color="green",x.title=e.getMessage("There_is_an_update_for_0name0_avaiable_",a.name),u(),m.parentNode&&m.parentNode.removeChild(m),Ga()):(x.style.color="red",x.title=e.getMessage("No_update_found__sry_"))})},a.lastUpdated)try{v=l(new Date,new Date(a.lastUpdated))}catch(B){console.log("o: error calculating time "+
B.message)}else v="?";x.textContent=v;var C=r("div","",a.uuid,"imported"),D="";z.push(function(){w.sync_enabled&&(D=a.nativeScript||a.nnew||a.system?"":a.sync&&a.sync.imported?!0===a.sync.imported||a.sync.imported==ja.types.ePASTEBIN?'<img src="https://pastebin.com/favicon.ico" class="icon16" title="pastebin.com"/>':a.sync.imported==ja.types.eCHROMESYNC?'<img src="https://www.google.com/images/icons/product/chrome-16.png" class="icon16" title="Google Sync"/>':a.sync.imported==ja.types.eGOOGLE_DRIVE?
'<img src="https://www.google.com/images/icons/product/drive-16.png" class="icon16" title="Google Drive"/>':'<img src="'+rea.extension.getURL("/layout/default/images/update.png")+'" class="icon16" />':"",C.innerHTML=D,C=null)});l=r("span","",a.uuid,"hp");if(a.origin){v=r("a","",a.uuid,"hp");v.setAttribute("href",a.origin.url);v.setAttribute("target","_blank");var E=n.createImage(O.origin(a.origin.token),"",a.uuid,a.origin.token,"");v.appendChild(E);l.appendChild(v)}p&&(v=r("a","",a.uuid,"hp"),v.setAttribute("href",
p),v.setAttribute("target","_blank"),p=n.createImage(rea.extension.getURL("/layout/default/images/home.png"),"",a.uuid,"hp",""),v.appendChild(p),l.appendChild(v));q[a.uuid].saveEm_lastModified=a.lastModified;q[a.uuid].fullReset=function(){b.parentNode.removeChild(b)};q[a.uuid].reportAnIssue=function(b){Ya(a.uuid,b)};q[a.uuid].deleteScript=function(c,d){if(a.nativeScript){var g=d||confirm(e.getMessage("Really_delete_0name0__",a.name));!0==g&&(za(a.uuid,"installed","false"),b.parentNode.removeChild(b))}else g=
d||confirm(e.getMessage("Really_delete_0name0__",a.name)),!0==g&&(xa(a.uuid,null,{reload:!d}),b.parentNode.removeChild(b))};p=[];if(a.nativeScript){q[a.uuid].importNativeScript=function(c,d){!0==(d||confirm(e.getMessage("Really_import_0name0__",a.name)))&&(za(a.uuid,"imported","true"),b.parentNode.removeChild(b))};var G=n.createImage(O.get("import"),"",a.uuid,"import",e.getMessage("Import"),function(){H(a.uuid,"importNativeScript")});n.addClass(G,"hidden");p.push(G);z.push(function(){w.native_import&&
n.toggleClass(G,"hidden")})}a.nnew||a.system||(v=n.createImage(O.get("delete"),"",a.uuid,"delete",e.getMessage("Delete"),function(){H(a.uuid,"deleteScript")}),p.push(v));a.nnew||a.system||!a.origin||(v=n.createImage(O.get("flag"),"",a.uuid,"issue",e.getMessage("Report_an_issue_to_the_script_hoster_"),function(){H(a.uuid,"reportAnIssue","hoster")}),p.push(v));a.nnew||a.system||!a.supportURL||(v=n.createImage(O.get("bug"),"",a.uuid,"bug",e.getMessage("Report_a_bug"),function(){H(a.uuid,"reportAnIssue",
"author")}),p.push(v));m.inserted||a.nativeScript||m.addEventListener("click",J);m.appendChild(s);v=[a.name];a.description&&v.push(e.getTranslation(a,"description"));a.blacklisted&&(v=[e.getMessage("This_script_is_blacklisted_")]);m.title=v.join("\n\n").replace(/\"/,"");f.push(a.nnew||a.system?null:{element:Za(a),style:"script_sel"});f.push(function(){var b=a.blacklisted?"enabler_warning":a.enabled?"enabler_enabled":"enabler_disabled",c=a.blacklisted?e.getMessage("This_script_is_blacklisted_"):a.enabled?
e.getMessage("Enabled"):e.getMessage("Disabled"),d=a.position,b=n.createEnabler(b,a.uuid,"enabled","enabled",c,function(){H(a.uuid,a.nativeScript?"switchNativeEnabled":"switchEnabled")},a.nativeScript?"":d);q[a.uuid].switchEnabled=function(b,c,d){void 0===c&&(c=!a.enabled);V(a.uuid,{enabled:c},d)};q[a.uuid].switchNativeEnabled=function(b,c,d){void 0===c&&(c=!a.enabled);za(a.uuid,"enabled",c,d)};return b}());f.push(m);f.push(h);f.push($a(a));f.push(C);f.push(ab(a));f.push(bb(a));f.push(l);f.push(x);
f.push(cb(a));f.push(function(a,b){var c=r("span","",a.uuid,"wrap");b&&("Array"===t.toType(b)?t.each(b,function(a,b){c.appendChild(a)}):c.appendChild(b));return c}(a,p));for(h=f.length;10>h;h++)f.push(null);!Y.scripts&&Q.open&&a.uuid===Q.open?z.push(J):a.nnew&&z.push(function(){J(null,!0)});return f},$a=function(a){var b=r("span","",a.uuid,"pos_type",!0);if(a.nnew)return b;a.user_agent?(a=n.createImage("images/user_agent.png","",a.uuid,"user_agent",e.getMessage("This_only_changes_the_user_agent_string")),
b.appendChild(a)):a.nativeScript?(a=n.createImage(a.icon,"",a.uuid,"chrome_ext",e.getMessage("This_is_a_chrome_extension")),b.appendChild(a)):a.userscript&&(a=n.createImage("images/txt.png","",a.uuid,"user_agent",e.getMessage("This_is_a_userscript")),b.appendChild(a));return b},bb=function(a){var b=r("span","",a.uuid,"pos_features",!0);if(a.nnew)return b;if(a.system){var c=n.createImage(rea.extension.getURL("/layout/default/images/lock.png"),"",a.uuid,"lock",e.getMessage("This_is_a_system_script"));
b.appendChild(c)}if(a.awareOfChrome||a.nativeScript)c=n.createImage("https://www.google.com/images/icons/product/chrome-16.png","",a.uuid,"chrome_mode",e.getMessage("This_script_runs_in_Chrome_mode")),b.appendChild(c);if(a.nativeScript)return b;a.requires.length&&(c=n.createImage(rea.extension.getURL("/layout/default/images/script_download.png"),"",a.uuid,"requires",t.map(t.select(a.requires,function(a){return a&&a.url}),function(a){return a.url}).join("\n")),b.appendChild(c));a.resources.length&&
(c=n.createImage(rea.extension.getURL("/layout/default/images/resources.png"),"",a.uuid,"resources",t.map(t.select(a.resources,function(a){return a&&a.url}),function(a){return a.url}).join("\n")),b.appendChild(c));var c=!1,d={includes:!0,matches:!0},g;for(g in d)if(a[g]){for(d=0;d<a[g].length;d++)if(a[g][d]&&(-1!=a[g][d].search("https")||-1!=a[g][d].search(/^\*:\/\//))){c=n.createImage(rea.extension.getURL("/layout/default/images/halfencrypted.png"),"",a.uuid,"encrypt",e.getMessage("This_script_has_access_to_https_pages"));
b.appendChild(c);c=!0;break}if(c)break}if(a.user_agent)return b;if(a.grant&&a.grant.length){var f={};a.grant.forEach(function(a){f[a]=!0});f.GM_xmlhttpRequest&&(c=n.createImage(rea.extension.getURL("/layout/default/images/web.png"),"",a.uuid,"web",e.getMessage("This_script_has_full_web_access")),b.appendChild(c));f.GM_setValue&&(c=n.createImage(rea.extension.getURL("/layout/default/images/db.png"),"",a.uuid,"db",e.getMessage("This_script_stores_data")),b.appendChild(c));f.unsafeWindow&&(c=n.createImage(rea.extension.getURL("/layout/default/images/windowlist.png"),
"",a.uuid,"unsafeWindow",e.getMessage("This_script_has_access_to_webpage_scripts")),b.appendChild(c))}else c=n.createImage(rea.extension.getURL("/layout/default/images/critical.png"),"grant",a.uuid,"crit",e.getMessage("This_script_has_no_grant_header_set_")),b.appendChild(c);for(g in a.options)if(-1!=g.search("compat_")&&a.options[g]){c=n.createImage(rea.extension.getURL("/layout/default/images/critical.png"),"compat",a.uuid,"crit",e.getMessage("One_or_more_compatibility_options_are_set"));b.appendChild(c);
break}return b},Ea=function(a){var b="global_hint_"+(a.class?a.class:"warning"),c=(new Date).getTime(),d=k("span",["global_hint",b].join(" "),"globalhint",c),b=r("span","globalhint_c",c),g=r("span","globalhint_t",c);a.title&&(g.title=a.title);a.image&&b.appendChild(n.createImage(O.get(a.image),"globalhint","icon"+c));g.textContent=a.text;a.onclick&&!g.inserted&&g.addEventListener("click",a.onclick);b.appendChild(g);d.appendChild(b);var f=$(d).hide().appendTo(document.body);window.setTimeout(function(){f.slideDown()},
f.delay?f.delay:1);a.timeout&&window.setTimeout(function(){f.slideUp(function(){f.remove()});a.done&&a.done(d)},a.timeout);return f},db=function(){var a=null,b=null,c=null,d=0,g=0,f=function(b){var d=c.x+b.pageX;a.style.top=c.y+b.pageY+"px";a.style.left=d+"px"},e=function(c){if(a){var e=null;for(f(c);e!=g;){var e=g,h=b.previousSibling,l=b.nextSibling,k=b.parentNode,n=m(b);c.pageY>n.y+d&&l?(k.removeChild(l),k.insertBefore(l,b),g++):c.pageY<n.y&&1<g&&(k.removeChild(h),l?k.insertBefore(h,l):k.appendChild(h),
g--)}}},m=function(a){for(var b=a.offsetLeft,c=a.offsetTop;a=a.offsetParent;)b+=a.offsetLeft,c+=a.offsetTop;return{x:b,y:c}},l={start:function(){document.addEventListener("mousemove",e);document.addEventListener("scroll",e)},stop:function(){document.removeEventListener("mousemove",e);document.removeEventListener("scroll",e)},handleEvent:function(e,h){if(a){a.style.position="static";var k={};k[a.key]=g;V(a.uuid,k);a=b=c=null;l.stop()}else l.start(),a=this,b=a.parentNode.parentNode.parentNode,d=b.offsetHeight,
c=m(b.parentNode.parentNode),c.x=-c.x-a.offsetWidth/2,c.y=-c.y-a.offsetHeight/2,a.style.position="absolute",f(e),g=h}};return l}(),cb=function(a){var b=k("span","sorting","",a.uuid,"pos_images",!0);if(a.nnew||a.nativeScript)return b;"pos"==R()&&"up"==U()||b.setAttribute("style","display: none;");if(1<a.position||a.position<a.positionof){var c=k("span","clickable movable","position",a.uuid,!0);c.innerHTML="&#9776;";c.title=e.getMessage("Click_here_to_move_this_script");c.uuid=a.uuid;c.key="position";
c.addEventListener("click",function(b){db.handleEvent.apply(this,[b,a.position])});b.appendChild(c)}return b},ab=function(a){var b=r("span","",a.uuid,"site_images"),c=null;b.inserted&&(c=b,c.setAttribute("id",c.id+"foo"),b=r("span","",a.uuid,"site_images"));ua.topIcons(a,7).forEach(function(a){b.appendChild(a,!0)});c&&c.parentNode.removeChild(c);return b},Za=function(a){var b=r("input","",a.uuid,"sel");b.type="checkbox";b.s_id=a.uuid;b.name="scriptselectors";b.s_type=a.nativeScript?"n":"s";b.inserted||
b.addEventListener("click",function(){q.multiselect.single_click()});return b},Ia=function(a){var b=k("input","multiselectcb","sms","all",null),c=k("input","multiselectcb","sms2","all",null);b.inserted||(b.type="checkbox",b.addEventListener("click",q.multiselect.un_selectAll),c.type="checkbox",c.addEventListener("click",q.multiselect.un_selectAll));var d=0,g=[{name:e.getMessage("__Please_choose__"),value:0},{name:e.getMessage("Enable"),value:1},{name:e.getMessage("Disable"),value:2},{name:e.getMessage("Toggle_Enable"),
value:7}];(ca.RUNTIME.CAN_SAVEAS_ZIP||"undefined"!==typeof Blob)&&g.push({name:e.getMessage("Export"),value:3});g=g.concat([{name:e.getMessage("Trigger_Update"),value:5},{name:e.getMessage("Remove"),value:6}]);g=n.createDropDown(e.getMessage("Apply_this_action_to_the_selected_scripts"),{value:0,uuid:"sms-select",name:"select"},g,function(){0==this.value?f.setAttribute("disabled","true"):f.removeAttribute("disabled");d=this.value});g.elem.setAttribute("class","float");g.elem.setAttribute("style","display: inline-block;");
var f=n.createButton("MultiSelectButton","button",e.getMessage("Start"),function(){if(0==d)console.log("option: ?!?!");else if(6!=d||confirm(e.getMessage("Really_delete_the_selected_items_"))){for(var a=document.getElementsByName("scriptselectors"),b=[],c=0;c<a.length;c++)b.push(a[c]);for(var a={},g,f=!1,k=100,c=0;c<b.length;c++)if(b[c].checked)if(1==d||2==d||7==d){g="n"==b[c].s_type?"switchNativeEnabled":"switchEnabled";var n;if(7==d){var q=P[b[c].s_id]?P[b[c].s_id].script:null;q&&(n=!q.enabled)}else n=
1==d;void 0!==n&&(H(b[c].s_id,g,null,n,!1),f=!0)}else 3==d?a[b[c].s_id]=!0:5==d?(g="scriptUpdate",H(b[c].s_id,g)):6==d&&(g="deleteScript",H(b[c].s_id,g,null,!0),f=!0,k=1500);3==d&&(u.wait(),fa(a,{storage:T}).then(function(a){u.wait();return ca.RUNTIME.CAN_SAVEAS_ZIP?N.zip.download(a).progress(function(a){u.wait(Math.floor(a.item/a.of*100)+"%")}):N.json.download(a)}).always(function(){u.hide()}));f&&(u.wait(e.getMessage("Please_wait___")),window.setTimeout(function(){Ga()},k))}});f.setAttribute("class",
"action_button");f.setAttribute("disabled","true");a=r("div",a.name,a.id,"actions");a.setAttribute("style","display: inline-block;");a.appendChild(g.elem);a.appendChild(f);return{selAllm:c,selAll:b,actionBox:a}};(function(){var a=0;q.multiselect={};q.multiselect.toggleRow=function(a){var c=$(document.getElementsByName("multiselectcol")||[]);a?c.show():c.hide()};q.multiselect.single_click=function(){for(var b=0,c=document.getElementsByName("scriptselectors"),d=!0,g=!1,f=!1,e=!0,k=!1,l=!1,n=0,p=0;p<
c.length;p++)"n"==c[p].s_type?(f=!0,d=d&&c[p].checked,g=g||c[p].checked):"s"==c[p].s_type&&(l=!0,e=e&&c[p].checked,k=k||c[p].checked),c[p].checked&&n++;!f||!d||l&&!e&&k||(b+=1);!l||!e||f&&!d&&g||(b+=2);b!=a&&(a=b,$(".multiselectcb").prop("checked",0!=b?"checked":""));q.multiselect.toggleRow(n);q.multiselect.checkScroll&&q.multiselect.checkScroll()};q.multiselect.un_selectAll=function(){3<++a&&(a=0);for(var b=!1,c=0,d=document.getElementsByName("scriptselectors"),g=0;g<d.length;g++)0!=g||1!=a&&3!=
a||"s"!=d[g].s_type||3<++a&&(a=0),b|="s"==d[g].s_type,d[g].checked=3==a||1==a&&"n"==d[g].s_type||2==a&&"s"==d[g].s_type,d[g].checked&&c++;1<a&&!b&&(a=0);$(".multiselectcb").prop("checked",0!=a?"checked":"");q.multiselect.toggleRow(c)}})();var ya={cleanGutters:function(a,b){a.clearGutter("gutter")},setGutters:function(a,b){for(var c in b)if(b.hasOwnProperty(c)){var d=b[c],g=0,f=null,h=[];d.marks=[];for(var k=0;k<d.length;k++){var l="",n=d[k];n.stop?(f="no",g=3):n.warn?(1>g&&(f="critical",g=1),l=e.getMessage("Warning")+
": "):n.info?(0==g&&(f="info"),l=e.getMessage("Info")+": "):2>g&&(f="error",g=2,l=e.getMessage("Error")+": ");h.push((1<d.length?l:"")+n.text.replace(/\"/g,'\\"'));n.stop||d.marks.push(a.markText({line:n.line-1,ch:n.character-1},{line:n.line-1,ch:n.character-1+n.evle},{className:"CodeMirror-highlight-"+f}))}d=$("<span>").append($("<span>").attr("class","editor_gutter").attr("title",h.join("\n\n")).append($("<span>").attr("width","15px").append($("<img>").attr("class","editor_gutter_img").attr("src",
rea.extension.getURL("/layout/default/images/"+f+".png")))))[0];a.setGutterMarker(Number(c)-1,"gutter",d)}return b},run:function(a){a.oldGutters&&ya.cleanGutters(a.mirror,a.oldGutters);return function(){var a=M();Registry.require("hinter",function(){a.resolve(Registry.get("hinter"))});return a.promise()}().then(function(b){return b.hint(a.mirror.getValue(),{maxerr:1E4},{})}).done(function(b){if(b){var c={};t.each(b,function(a){if(a&&1<a.line){var b=a.line,f=a.character,e=0,k=a.reason.toLowerCase(),
l=-1!=k.search("mixed spaces and tabs"),n=0;try{var p=!!a.evidence&&!l;if(p)for(var q=0,r=0;q<f&&r<f;q++,r++)9==a.evidence.charCodeAt(q)&&(r+=w.editor_indentUnit-1,e+=1);f-=e*(w.editor_indentUnit-1);if(p||l)var u=a.evidence.length>f?a.evidence.substr(f-1):"",t=l?u.match(/([ \t])*/):u.match(/([a-zA-Z0-9_])*/),n=t&&t.length?t[0].length:0}catch(z){console.log("jshint: error parsing source "+z.message)}e=n||1;a={line:b,stop:0==k.search("stopping"),info:l||-1!=k.search("forgotten")||-1!=k.search("not necessary")||
-1!=k.search("unnecessary")||-1!=k.search("better written")||-1!=k.search("bad line breaking")||-1!=k.search("semicolon"),warn:"(error)"!=a.id||-1!=k.search("unreachable")||-1!=k.search("to compare with")||-1!=k.search("can be")||-1!=k.search("is preferable")||-1!=k.search("already defined"),character:f,evle:e,text:a.code+": "+a.reason.replace(/.$/,"")};a.stop&&b++;c[b]||(c[b]=[]);c[b].push(a)}});a.oldGutters=ya.setGutters(a.mirror,c)}})}},X=null,G=function(){X&&(window.clearTimeout(X),X=null)},ga=
null,K=function(){ga&&$(ga).remove();ga=Ea({text:e.getMessage("Operation_completed_successfully"),image:"button_ok",class:"notice",delay:500,timeout:3E3,done:function(){ga=null}})},L=function(){X||(X=window.setTimeout(function(){X=null;u.wait(e.getMessage("Please_wait___"))},500))},ba=null,ha=null,B=function(a){null!=ba?(window.clearTimeout(ba),ba=null,B(a?a:ha.items)):(ha={items:a},ba=window.setTimeout(function(){ba=null;P={};var a=ha.items,c=ia.create("_main",k("div","tv_container","opt","tv_container"));
ea(null,a,null,c);u.hide();qa();ha=null},50))},ta=function(a,b){try{var c=function(){b&&ca.OPTIONPAGE.CLOSE_ON_NEW_TAB&&window.close()};b?sendMessage({method:"newTab",url:a},c):rea.tabs.getSelected(null,function(d){rea.tabs.sendMessage(d.id,{method:"loadUrl",url:a,newtab:b},c)})}catch(d){console.log("lU: "+d.message)}},Pa=function(a,b){var c=M();try{L(),sendMessage({method:"installScript",url:a,reload:b.reload},function(a){G();a.items?(K(),B(a.items)):u.hide();a.err?c.reject(a):c.resolve(a)})}catch(d){console.log("sS: "+
d.message),c.reject({err:d.message})}return c.promise()},Oa=function(a,b){var c=M();try{L(),sendMessage({method:"exportToJson",ids:a,options:b},function(a){K();G();u.hide();a.json?c.resolve(a.json):c.reject()})}catch(d){console.log("eJ: "+d.message),c.reject({})}return c.promise()},va=function(a,b){var c=M();try{L(),sendMessage({method:"importFromJson",json:a,reload:b.reload},function(a){G();a.items?(K(),B(a.items)):u.hide();a.err?c.reject(a):c.resolve(a)})}catch(d){console.log("sS: "+d.message),
c.reject({err:d.message})}return c.promise()},xa=function(a,b,c){var d=M();void 0===c.reload&&(c.reload=!0);try{var e=c.new_url&&c.new_url!=c.old_url?c.new_url:"";L();sendMessage({method:"saveScript",uuid:a,code:b,clean:c.clean,force:c.force,new_script:c.new_script,force_url:e,lastModified:c.lastModified,reload:c.reload},function(a){G();K();a.items?B(a.items):u.hide();!b&&c.reload&&u.hide();d.resolve(a)})}catch(f){console.log("sS: "+f.message),d.reject({err:f.message})}return d.promise()},ra=function(a,
b,c){try{L(),sendMessage({method:"setOption",name:a,value:b},function(a){G();K();w=a.options||w;!c&&a.items?B(a.items):u.hide()})}catch(d){console.log("sO: "+d.message)}},Ka=function(a,b,c,d){try{L(),sendMessage({method:"buttonPress",name:a},function(a){G();d?window.location.reload():!c&&a.items?(K(),B(a.items)):u.hide()})}catch(e){console.log("sO: "+e.message)}},da=function(a,b){L();sendMessage({method:"loadTree",complete:a.complete,uuid:a.uuid,referrer:a.referrer},function(a){G();w=a.options||w;
a.i18n&&e.setLocale(a.i18n);a.items||(a.error?alert(a.error):confirm(e.getOriginalMessage("An_internal_error_occured_Do_you_want_to_visit_the_forum_"))&&(window.location.href="http://tampermonkey.net/bug"));b(a)})},Ga=function(){da({referrer:"options.scripts"},function(a){a.items?B(a.items):u.hide()})},V=function(a,b,c){void 0==c&&(c=!0);try{a={method:"modifyScriptOptions",uuid:a,reload:c};for(var d in b)b.hasOwnProperty(d)&&(a[d]=b[d]);L();sendMessage(a,function(a){G();w=a.options||w;a.i18n&&e.setLocale(a.i18n);
K();a.items?B(a.items):u.hide()})}catch(g){console.log("mSo: "+g.message)}},za=function(a,b,c,d){void 0===d&&(d=!0);try{a={method:"modifyNativeScript",nid:a,actionid:b,value:c,reload:d},L(),sendMessage(a,function(a){G();K();a.items?B(a.items):u.hide()})}catch(e){console.log("mSo: "+e.message)}},Wa=function(a,b){try{L(),sendMessage({method:"buttonPress",name:"externals_delete",scriptuid:a,url:b},function(a){G();K();a.items?B(a.items):u.hide()})}catch(c){console.log("dEx: "+c.message)}},Xa=function(a,
b){try{sendMessage({method:"buttonPress",name:"run_script_updates",scriptuid:a},function(a){K();b&&b(a.updatable)})}catch(c){console.log("rSu: "+c.message)}},Ya=function(a,b,c){try{sendMessage({method:"reportAnIssue",uuid:a,to:b},function(a){c&&c()})}catch(d){console.log("rRi: "+d.message)}};rea.extension.onMessage.addListener(function(a,b,c){if("updateOptions"==a.method)w=a.options||w,B(a.items),c({});else if("confirm"==a.method)t.confirm(a.msg,function(a){c({confirm:a})});else if("showMsg"==a.method)t.alert(a.msg),
c({});else return!1;return!0});(function(){da({referrer:"options"},function(a){Ra();a.items?B(a.items):u.hide()})})()})});
