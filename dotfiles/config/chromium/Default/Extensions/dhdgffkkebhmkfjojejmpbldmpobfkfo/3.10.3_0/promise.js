(function(h){var d=function(e){var a=function(){var a,e,f=[];f.notify=function(b){f.forEach(function(a){a(b)})};var c=[];c._push=c.push;c.push=function(){c._push.apply(c,arguments);c.check()};c.check=function(){if(void 0!==a)for(var b;c.length;)if(b=c.shift(),void 0===b.state||b.state===a)e=("function"===typeof b.f?b.f.call(g,e):b.f)||e};var g={promise:function(){return g},done:function(b){c.push({state:!0,f:b});return g},fail:function(b){c.push({state:!1,f:b});return g},always:function(b){c.push({f:b});
return g},progress:function(b){f.push(b);return g},then:function(b,a,c){return d(function(d){[{fn:"done",forward:"resolve",f:b},{fn:"fail",forward:"reject",f:a},{fn:"progress",forward:"notify",f:c}].forEach(function(b){g[b.fn](function(){var a="function"===typeof b.f,c=a?b.f(e):void 0;c&&"function"===typeof c.promise?c.promise().done(d.resolve).fail(d.reject).progress(d.notify):d[b.forward].apply(d,a?[c]:arguments)})})}).promise()},each:function(b){return g.then(function(a){a instanceof Array||(a=
arguments);return d.when(a.map(function(a){return b(a)}))})},iterate:function(a){return g.then(function(c){c instanceof Array||(c=arguments);var e=0,f=d(),g=function(){if(e<c.length){var d=c[e++];(d=a(d))&&d.promise?d.promise().done(g).fail(f.reject):g()}else f.resolve(c)};g();return f.promise()})}};return{get:function(){return g},try_resolve:function(b){void 0===a&&(a=!0,e=b);c.check()},try_reject:function(b){void 0===a&&(a=!1,e=b);c.check()},do_notify:function(a){f.notify(a)}}}(),f={promise:function(){return a.get()},
resolve:function(){return a.try_resolve.apply(this,arguments)},reject:function(){return a.try_reject.apply(this,arguments)},notify:function(){return a.do_notify.apply(this,arguments)}};e&&e(f);return f};d.Pledge=function(e){var a=d();a.resolve(e);return a.promise()};d.Breach=function(e){var a=d();a.reject(e);return a.promise()};d.when=function(e){e instanceof Array||(e=arguments);var a=d(),f=e.length;f?e.forEach(function(d){d&&d.promise&&d.promise().fail(function(){a.reject();f=-1}).done(function(){0===
--f&&a.resolve()})}):a.resolve();return a.promise()};h.Registry?h.Registry.register("promise","3",function(){return d}):"undefined"!==typeof require?module.exports.Deferred=d:h.Deferred=d})("undefined"!==typeof window?window:GLOBAL);
